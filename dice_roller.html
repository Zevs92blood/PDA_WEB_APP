<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Кубомет Daggerheart v4.0 (iPAQ)</title>
    <style>
        /* Стиль, оптимизированный под iPAQ (аналог v2.6) */
        body { 
            font-family: Tahoma, sans-serif; /* Изменено на Tahoma для iPAQ */
            text-align: center; 
            color: #FFF; /* Цвет текста всего документа */
            background-color: #000000;
            padding: 5px;
        }
        h2 { color: #FFF; margin-bottom: 15px; font-size: 16px; }
        /* ИЗМЕНЕНИЕ 1: Цвет заголовков блоков h3 меняем на ЧЁРНЫЙ (#000) */
        h3 { color: #000; margin-top: 10px; font-size: 14px; } 
        .controls { 
            margin-bottom: 15px; 
            border: 1px solid #AAA; 
            padding: 10px; 
            background-color: #FFF; /* Белый фон карточки */
            color: #333; /* Цвет текста внутри карточки */
        }
        .input-group { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        label { font-size: 14px; }
        
        /* Изменено на общие стили для лучшей совместимости */
        input[type="number"], select, button { 
            padding: 8px; 
            font-size: 16px; 
            margin: 5px 0; 
            width: 100%; 
            box-sizing: border-box; 
        }
        input[type="number"] { width: 50px; text-align: center; }
        
        button { 
            cursor: pointer; 
            background-color: #007bff; 
            color: white; 
            border: none; 
        }

        #result-box { 
            margin-top: 20px; 
            padding: 10px; 
            border: 2px solid #00ffff; /* Изменено на синий для контраста */
            min-height: 80px; 
            background-color: #333; /* Темный фон для контраста */
        }
        
        #result-text { 
            font-size: 16px; 
            font-weight: bold;
            text-align: center;
            color: #fff; /* Белый текст результата */
        }
        
        /* Стили для нового селектора кубов */
        .dice-selector {
            width: 70px; /* Уменьшаем ширину селектора кубов */
            display: inline-block;
            margin-right: 5px;
        }
        
    </style>
</head>
<body id="body">

    <h2>Кубомет Daggerheart v4.0 (iPAQ)</h2>

    <div class="controls">
        <h3>Двойственность (к12 Н/С)</h3>
        <div class="input-group">
            <label for="modifier_i">Модификатор:</label>
            <input type="number" id="modifier_i" value="0" min="-99" max="99" style="width: 50%;">
        </div>

        <div class="input-group" style="justify-content: space-around;">
            <div>
                <label for="advantage_i">Преимущество</label>
                <input type="checkbox" id="advantage_i">
            </div>
            <div>
                <label for="disadvantage_i">Помеха</label>
                <input type="checkbox" id="disadvantage_i">
            </div>
        </div>
        
        <button onclick="rollDuality_i(); return false;">Бросить Двойственность</button>
    </div>

    <div class="controls">
        <h3>Обычный бросок</h3>
        <div class="input-group">
            <label for="d20-modifier_i" style="width: 30%;">Тип куба:</label>
            <select id="dice-type" class="dice-selector" style="width: 25%;">
                <option value="4">к4</option>
                <option value="6">к6</option>
                <option value="8">к8</option>
                <option value="10">к10</option>
                <option value="12">к12</option>
                <option value="20" selected>к20</option>
                <option value="100">к100</option>
            </select>
            <label for="d20-modifier_i" style="width: 20%;">Мод:</label>
            <input type="number" id="d20-modifier_i" value="0" min="-99" max="99" style="width: 25%;">
        </div>
        <button onclick="rollBasicDice()">Бросить</button> </div>
    
    <div id="result-box">
        <div id="result-text">
            Добро пожаловать!
        </div>
    </div>

    <div style="font-size: 10px; color: #999; margin-top: 15px; text-align: right;">Версия: v4.0-iPAQ</div>

    <script>
        // --- УТИЛИТЫ ---
        function getElement(id) {
            return document.getElementById(id);
        }
        
        function roll(max) {
            return Math.floor(Math.random() * max) + 1;
        }

        // Окрашивание фона (без анимации)
        function updateBackground_i(outcomeType) {
            var color;
            if (outcomeType === 'CRIT') {
                color = '#FFFF00'; // Желтый для Крита
            } else if (outcomeType === 'HOPE') {
                color = '#008000'; // Зеленый для Надежды
            } else if (outcomeType === 'FEAR') {
                color = '#FF0000'; // Красный для Страха
            } else {
                color = '#000000'; // Черный для обычных бросков
            }
            getElement('body').style.backgroundColor = color;
        }

        // --- DUALITY (к12 Н/С) ---
        function rollDuality_i() {
            var mod = parseInt(getElement('modifier_i').value || '0');
            var adv = getElement('advantage_i').checked;
            var dis = getElement('disadvantage_i').checked;
            
            getElement('result-text').innerHTML = 'Бросаем к12...';

            // Логика двойного броска для Надежды/Страха
            var roll1 = roll(12);
            var roll2 = roll(12);
            
            var successRoll = roll1;
            var stressRoll = roll2;

            // Логика Преимущества/Помехи, влияющая на присвоение Н/С
            if (adv && !dis) {
                successRoll = Math.max(roll1, roll2);
                stressRoll = Math.min(roll1, roll2); 
            } else if (dis && !adv) {
                successRoll = Math.min(roll1, roll2);
                stressRoll = Math.max(roll1, roll2);
            }
            // Если и то, и то, или ничего - используем roll1 как Надежду, roll2 как Страх

            var finalSuccess = successRoll + mod;
            
            var outcomeText;
            var outcomeType;
            
            if (successRoll === stressRoll) {
                outcomeText = 'КРИТ. УСПЕХ';
                outcomeType = 'CRIT';
            } else if (successRoll > stressRoll) {
                outcomeText = 'НАДЕЖДА';
                outcomeType = 'HOPE';
            } else {
                outcomeText = 'СТРАХ';
                outcomeType = 'FEAR';
            }

            // ИЗМЕНЕНИЕ 3: Формат вывода для Дуализма
            var resultHTML = 
                'Н: ' + successRoll + ' / С: ' + stressRoll + 
                ' / Мод: ' + (mod >= 0 ? '+' : '') + mod + 
                ' / ИТОГ: ' + finalSuccess + 
                ' / Исход: ' + outcomeText;

            updateBackground_i(outcomeType); 
            
            getElement('result-text').innerHTML = resultHTML;
            return false; // Добавлено, чтобы избежать перезагрузки
        }

        // --- ОБЫЧНЫЙ БРОСОК (кD) ---
        function rollBasicDice() {
            // Получаем тип куба из нового селектора
            var type = parseInt(getElement('dice-type').value);
            var mod = parseInt(getElement('d20-modifier_i').value || '0');
            
            getElement('result-text').innerHTML = 'Бросаем к' + type + '...';

            var rollValue = roll(type);
            var total = rollValue + mod;

            var modSign = mod >= 0 ? '+' : '';

            // ИЗМЕНЕНИЕ 4: Формат вывода для Обычного броска (1кD)
            var resultHTML = 
                '[1к' + type + '] Броски: (' + rollValue + ');' +
                ' Мод: ' + modSign + mod + ';' +
                ' ИТОГ: ' + total;

            // Обновляем фон (обычные броски - всегда черный фон)
            updateBackground_i(null); 
            
            getElement('result-text').innerHTML = resultHTML;
            return false;
        }

        // --- Инициализация ---
        window.onload = function() {
            // Логика переключения Преимущества/Помехи
            getElement('advantage_i').addEventListener('change', function() {
                if (this.checked) getElement('disadvantage_i').checked = false;
            });
            getElement('disadvantage_i').addEventListener('change', function() {
                if (this.checked) getElement('advantage_i').checked = false;
            });
        };
    </script>
</body>
</html>
