<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Кубомет Daggerheart v1.0 (iPAQ)</title>
    <style>
        /* Стиль, оптимизированный под iPAQ (аналог v2.6) */
        body { 
            font-family: sans-serif; 
            text-align: center; 
            color: #333; 
            background-color: #000000; /* Исходный черный фон */
            padding: 5px;
        }
        h2 { color: #FFF; margin-bottom: 15px; }
        h3 { color: #EEE; margin-top: 10px; }
        .controls { 
            margin-bottom: 15px; 
            border: 1px solid #AAA; 
            padding: 10px; 
            background-color: #FFF; 
        }
        .input-group { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        label { font-size: 14px; }
        input[type="number"], button { 
            padding: 8px; 
            font-size: 16px; 
            margin: 5px 0; 
            width: 100%; 
            box-sizing: border-box; 
        }
        input[type="number"] { width: 50px; text-align: center; }
        button { 
            cursor: pointer; 
            background-color: #007bff; 
            color: white; 
            border: none; 
        }

        #result-box { 
            margin-top: 20px; 
            padding: 10px; 
            border: 2px solid #333; 
            min-height: 80px; 
            background-color: #DDD; 
        }
        
        #result-text { 
            font-size: 16px; 
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body id="body">

    <h2>Кубомет Daggerheart v1.0 (iPAQ)</h2>

    <div class="controls">
        <h3>Двойственность (к12 Н/С)</h3>
        <div class="input-group">
            <label for="modifier_i">Модификатор:</label>
            <input type="number" id="modifier_i" value="0" min="-99" max="99">
        </div>

        <div class="input-group" style="justify-content: space-around;">
            <div>
                <label for="advantage_i">Преимущество</label>
                <input type="checkbox" id="advantage_i">
            </div>
            <div>
                <label for="disadvantage_i">Помеха</label>
                <input type="checkbox" id="disadvantage_i">
            </div>
        </div>
        
        <button onclick="rollDuality_i()">Бросить Двойственность</button>
    </div>

    <div class="controls">
        <h3>Удача (к20)</h3>
        <div class="input-group">
            <label for="d20-modifier_i">Модификатор:</label>
            <input type="number" id="d20-modifier_i" value="0" min="-99" max="99">
        </div>
        <button onclick="rollFortune_i()">Бросить Удачу</button>
    </div>
    
    <div id="result-box">
        <div id="result-text">
            Добро пожаловать!
        </div>
    </div>

    <div style="font-size: 10px; color: #999; margin-top: 15px; text-align: right;">Версия: v1.0-iPAQ</div>

    <script>
        // --- УТИЛИТЫ ---
        function getElement(id) {
            return document.getElementById(id);
        }
        
        // Окрашивание фона (без анимации)
        function updateBackground_i(isSuccess, isDuality) {
            var color;
            if (isDuality) {
                // Если Двойственность (к12)
                color = isSuccess ? '#008000' : '#FF0000'; // Зеленый или Красный
            } else {
                // Если Удача (к20) - черный фон
                color = '#000000';
            }
            getElement('body').style.backgroundColor = color;
        }

        // --- DUALITY (к12 Н/С) для iPAQ ---
        function rollDuality_i() {
            var mod = parseInt(getElement('modifier_i').value || '0');
            var adv = getElement('advantage_i').checked;
            var dis = getElement('disadvantage_i').checked;
            
            getElement('result-text').innerHTML = 'Бросаем к12...';

            var roll1 = Math.floor(Math.random() * 12) + 1;
            var roll2 = Math.floor(Math.random() * 12) + 1;
            
            var successRoll = roll1;
            var stressRoll = roll2;

            if (adv && !dis) {
                successRoll = Math.max(roll1, roll2);
                stressRoll = Math.min(roll1, roll2); 
            } else if (dis && !adv) {
                successRoll = Math.min(roll1, roll2);
                stressRoll = Math.max(roll1, roll2);
            }

            var finalSuccess = successRoll + mod;
            var finalStress = stressRoll;

            var resultHTML = 
                '**Двойственность (к12):**' +
                '<br>Успех: ' + finalSuccess + ' (к12:' + successRoll + ' + ' + mod + ')' +
                '<br>Стресс: ' + finalStress + ' (к12:' + stressRoll + ')';

            var isSuccess = finalSuccess >= 7;

            // Обновляем фон (к12 броски)
            updateBackground_i(isSuccess, true); 
            
            getElement('result-text').innerHTML = resultHTML;
        }

        // --- FORTUNE (к20) для iPAQ ---
        function rollFortune_i() {
            var mod = parseInt(getElement('d20-modifier_i').value || '0');
            getElement('result-text').innerHTML = 'Бросаем к20...';

            var roll = Math.floor(Math.random() * 20) + 1;
            var total = roll + mod;

            var resultHTML = 
                '**Удача (к20):**' +
                '<br>Результат: ' + total + ' (к20:' + roll + ' + ' + mod + ')';

            var isSuccess = roll >= 11;

            // Обновляем фон (к20 броски) - всегда черный фон
            updateBackground_i(isSuccess, false); 
            
            getElement('result-text').innerHTML = resultHTML;
        }
    </script>
</body>
</html>
