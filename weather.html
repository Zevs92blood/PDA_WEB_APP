<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Погода для iPAQ (v1.3)</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #E0E0FF; color: #333; }
        #result { margin-top: 20px; padding: 10px; border: 1px solid #AAA; background-color: #FFF; min-height: 50px; text-align: left; }
        button { padding: 10px 20px; font-size: 16px; margin-top: 15px; }
        select { padding: 8px; font-size: 14px; margin-bottom: 15px; border: 1px solid #777; }
        h1 { margin-bottom: 5px; }
        .version { font-size: 10px; color: #666; margin-top: 20px; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-size: 10px; }
        /* Новый стиль для кнопки-ссылки */
        .api-link {
            display: inline-block;
            background-color: #4CAF50; /* Зеленый цвет */
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            margin-top: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1>Выбор города:</h1>
    
    <select id="city-select">
        <option value="53.05,50.85">Покровка (Н-р-н)</option>
        <option value="53.20,50.15">Самара (Обл. центр)</option>
    </select>
    
    <a href="#" id="api-button" class="api-link" onclick="getApiUrl(event)">ПРОВЕРИТЬ API</a>
    
    <div id="result">Нажмите "ПРОВЕРИТЬ API", чтобы увидеть, может ли браузер получить JSON.</div>
    
    <div class="version">Версия: 1.3 (Тест прямой ссылки)</div>

    <script>
        const LOCATIONS = {
            '53.05,50.85': 'Покровке',
            '53.20,50.15': 'Самаре'
        };

        // Эта функция генерирует URL и перенаправляет браузер.
        function getApiUrl(event) {
            // event.preventDefault(); // Закомментируем, чтобы разрешить переход
            
            const selectElement = document.getElementById('city-select');
            const selectedValue = selectElement.value;
            const lat = selectedValue.split(',')[0];
            const lon = selectedValue.split(',')[1];
            
            // Запрос по HTTP для обхода проблемы с SSL
            const API_URL = 'http://api.open-meteo.com/v1/forecast?latitude=' + lat + '&longitude=' + lon + '&current=temperature_2m&timezone=Europe%2FMoscow';
            
            // Устанавливаем ссылку на кнопке и переходим
            document.getElementById('api-button').href = API_URL;
            return true; // Разрешаем переход
        }
    </script>
</body>
</html>
